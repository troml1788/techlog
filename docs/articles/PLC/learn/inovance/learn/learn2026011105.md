## **一、课程大纲总结**

本节课程以 **交通灯时序控制** 为实际案例，系统讲解了如何运用**定时器指令**和**触点比较指令**在PLC中实现复杂的时序逻辑。课程的核心目标是展示一种简化、高效且易于维护的程序设计方法。

课程的主要流程如下：
1.  **引入案例**：明确交通灯控制的需求（东西、南北方向交替亮灯，20秒一个循环周期）。
2.  **核心思路**：提出使用**单一20秒定时器**作为整个系统的时间基准，替代为每个方向或每个状态单独设置定时器的传统方法，以简化逻辑。
3.  **分步实现**：
    *   **整体循环**：讲解如何利用一个定时器并通过复位指令实现20秒的自动循环计时。
    *   **东西方向控制**：详细分析如何根据定时器的当前值，使用比较指令划分不同阶段（绿灯常亮、绿灯闪烁、黄灯、红灯），并控制输出点。
    *   **南北方向控制**：基于同一时间基准，讲解南北方向信号灯的逻辑，其状态与东西方向严格互补。
    *   **闪烁逻辑封装**：重点讲解将绿灯闪烁功能编写为独立的**子程序**，以提高代码的模块化性和重用性。
4.  **技术要点回顾**：总结程序中使用的关键指令和编程技巧。

---

## **二、知识点归纳总结**

#### **1. 核心控制理念：单定时器同步控制**
*   **目标**：用一个公共的时间基准驱动整个系统，确保东西和南北方向的信号灯状态严格同步。
*   **实现**：使用一个设定值为20秒（20000毫秒）的接通延时定时器。定时器到时后，通过一个中间继电器（如M1）自动复位定时器本身，从而实现无间隔的循环计时。
*   **优势**：程序结构清晰，避免了多个定时器之间协调的复杂性，易于调试和修改。

#### **2. 关键编程指令：触点比较指令**
*   **功能**：通过比较两个数值（如定时器当前值 `D0` 和设定常数 `K`）的大小关系（如大于、小于、等于）来触发逻辑条件，从而控制输出的通断。
*   **应用**：这是实现分阶段控制的核心技术。例如：
    *   `当 D0 < K5000 时`，东西方向绿灯亮。
    *   `当 D0 > K10000 且 D0 < K20000 时`，东西方向红灯亮。
*   **优势**：非常灵活，可以精确地定义状态的开始和结束时间，实现复杂的时序控制。

#### **3. 东西与南北方向信号灯的逻辑分解**
基于20秒周期，两个方向的灯态时序如下：

| 时间阶段 (秒) | 东西方向 | 南北方向 | 关键动作 |
| :--- | :--- | :--- | :--- |
| **0 - 5** | **绿灯常亮** (Y0) | **红灯亮** | 东西通行 |
| **5 - 8** | **绿灯闪烁** | **红灯亮** | 东西绿灯闪烁3秒，准备切换 |
| **8 - 10** | **黄灯亮** (Y2) | **红灯亮** | 东西方向警示 |
| **10 - 15** | **红灯亮** | **绿灯常亮** (Y3) | 南北通行 |
| **15 - 18** | **红灯亮** | **绿灯闪烁** | 南北绿灯闪烁3秒，准备切换 |
| **18 - 20** | **红灯亮** | **黄灯亮** (Y5) | 南北方向警示 |

**要点**：两个方向的控制逻辑基于**同一个定时器当前值（D0）** 进行编写，只是比较的条件不同，确保了绝对的同步。

#### **4. 模块化编程：闪烁子程序**
*   **目的**：将通用的闪烁逻辑独立出来，避免在东西和南北方向的控制程序中重复编写相同代码。
*   **实现**：
    *   创建一个独立的闪烁程序，内部使用一个短周期定时器（如0.5秒周期）产生连续的方波信号。
    *   在主程序中，只有当需要闪烁时（如东西方向在5-8秒期间），才调用这个子程序的输出结果。
*   **闪烁细节**：
    *   **周期选择**：推荐0.5秒或1秒，以保证清晰、流畅的视觉效果。
    *   **逻辑设计**：采用“先灭后亮”的方式，在3秒内可以完整显示6次闪烁（0.5秒/次 × 6 = 3秒）。
*   **优势**：代码复用性强，结构清晰，修改闪烁频率只需改动子程序一处。

#### **5. 编程优化与注意事项**
*   **条件简化**：某些比较条件可以省略（如 `D0 > 0`），因为定时器从0开始计时，理解其运行机制有助于编写更简洁的代码。
*   **信号输出**：闪烁子程序的输出不应直接控制实际的灯（Y0, Y3），而应通过中间变量与主程序的条件进行“与”逻辑运算后，再输出到物理点。

**总结**：本节课程通过一个完整的案例，生动演示了**以时间为主线，运用比较指令进行条件判断，并结合模块化设计**的先进编程思想，是掌握时序控制类PLC程序设计的经典范例。